/* -*-c++-*- OpenSceneGraph - Copyright (C) 1998-2006 Robert Osfield
 *
 * This library is open source and may be redistributed and/or modified under
 * the terms of the OpenSceneGraph Public License (OSGPL) version 0.0 or
 * (at your option) any later version.  The full license is in LICENSE file
 * included with this distribution, and on the openscenegraph.org website.
 *
 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * OpenSceneGraph Public License for more details.
*/

#ifndef OSGPRESENTATION_TIMOUTOUT
#define OSGPRESENTATION_TIMOUTOUT 1

#include <osg/Transform>

#include <osgPresentation/SlideEventHandler>

namespace osgPresentation {

class OSGPRESENTATION_EXPORT HUDSettings : public osg::Referenced
{
    public:
        HUDSettings(double slideDistance, float eyeOffset, unsigned int leftMask, unsigned int rightMask);

        virtual bool getModelViewMatrix(osg::Matrix& matrix, osg::NodeVisitor* nv) const;

        virtual bool getInverseModelViewMatrix(osg::Matrix& matrix, osg::NodeVisitor* nv) const;

        double          _slideDistance;
        double          _eyeOffset;
        unsigned int    _leftMask;
        unsigned int    _rightMask;

protected:

        virtual ~HUDSettings();
};
    
class OSGPRESENTATION_EXPORT Timeout : public osg::Transform
{
    public:

        Timeout(HUDSettings* hudSettings=0);

        /** Copy constructor using CopyOp to manage deep vs shallow copy.*/
        Timeout(const Timeout& timeout,const osg::CopyOp& copyop=osg::CopyOp::SHALLOW_COPY);

        META_Node(osgPresentation, Timeout);

        void setIdleDurationBeforeTimeoutDisplay(double t) { _idleDurationBeforeTimeoutDisplay = t; }
        double getIdleDurationBeforeTimeoutDisplay() const { return _idleDurationBeforeTimeoutDisplay; }
        
        void setIdleDurationBeforeTimeoutAction(double t) { _idleDurationBeforeTimeoutAction = t; }
        double getIdleDurationBeforeTimeoutAction() const { return _idleDurationBeforeTimeoutAction; }

        void setJumpData(const JumpData& jumpData) { _jumpData = jumpData; }
        const JumpData& getJumpData() const { return _jumpData; }

        virtual bool computeLocalToWorldMatrix(osg::Matrix& matrix,osg::NodeVisitor* nv) const;

        virtual bool computeWorldToLocalMatrix(osg::Matrix& matrix,osg::NodeVisitor*) const;

        virtual void traverse(osg::NodeVisitor& nv);

    protected:

        virtual ~Timeout();

        osg::ref_ptr<HUDSettings> _hudSettings;

        int     _previousFrameNumber;
        double  _timeOfLastEvent;
        double  _idleDurationBeforeTimeoutDisplay;
        double  _idleDurationBeforeTimeoutAction;

        JumpData _jumpData;
};

}

#endif